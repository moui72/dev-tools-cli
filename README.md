# Installing

## Infra

This tool relies on AWS infrastructure, which has not been well abstracted out. This repo is intended for educational purposes, so you're mostly on your own for setting up the infra, though a terraform module is included (see `infra/` in the source code).

## CLI

You can install this tool from the git repo using `pip`. You can also install it from the git repo via poetry, but there are [some caveates](#via-poetry) if you install that way.

### Via Git

You can clone this repo, and then install the CLI via pip

1. clone repo: `gh repo clone moui72/dev-tools` or `git clone git@github.com:moui72/dev-tools.git`
1. from within the repo directory, install via pip with `pip install --editable .`[^editable]

### Via poetry

You can also install this application via [poetry](https://python-poetry.org/) rather than `pip`, but doing so will make it isolated to a virtual environment and therefore not globally available via the `dev` command, while the rest of this documentation assumes it is globally available.

If you choose to use poetry, be aware that all `dev ...` commands must be run from within the poetry-created venv, i.e., from within the project directory via `poetry run dev ...`.

1. clone repo: `gh repo clone moui72/dev-tools` or `git clone git@github.com:moui72/dev-tools.git`
1. from within the repo directory, install via poetry `poetry install`

[^editable]: The `--editable` option with `pip install` allows changes made to the source code to be immediately reflected on execution, without having to rebuild the package
# Design

Design documents for dev-tools. This was original created for Vault Health, but the code has been sanitized and made public for educational purposes.

## Param store

The basic design of the `param-store` set of commands is that objects are added to an S3 bucket, which triggers notification rules. The notification rules pipe messages into one of two SQS queue based the key prefix: `requested/`, `accepted/`, or `rejected/` go into the notification queue, while `review/`, goes into the review queue.

![Architecture Diagram](assets/param-store-cli-bg.svg)

There are two commands for now: `request` and `review`. A successful `request` creates an S3 object with a key prefixed by `requested/`. The notifier lambda will move these object to the same key, but replacing the prefix with `review/`.

There is no lambda that processes the review queue; instead, that queue is consumed by the `review` command. A successful review will, depending on reviewer input, move the object to the same key, but replacing the prefix with `accepted/` or `rejected/` as appropriate. If the `review` command errors or the reviewer chooses not to approve or accept, the object will be moved back to the same key, but replacing the `review/` prefix with `requested/` so it can be reviewed again later.
# Contributing

Tools and ecosystem for development.

## Pre-commit

This repo uses [pre-commit](https://pre-commit.com/) to enforce style and manage code quality. Please run `pre-commit install` after cloning so that the hooks will run when you commit.

## Poetry

This project uses [poetry](https://python-poetry.org/docs/#installation) to manage dependencies and build the package. You will need to install it.

## Building docs

> :warning: Do not edit README.md manually, any changes will be overwritten by docs autogeneration!

This project uses the [typer-cli](https://typer.tiangolo.com/typer-cli/#generate-docs) to generate the usage documentation. The `README.md` is a concatenation of those autogenerated docs (the [`dev`](#dev) section) as well as some static markdown files, like this one. The static markdown files are in the `scripts` directory and can be edited.

Run `sh scripts/make_docs` or `pre-commit run --hook-stage manual` to autogenerate a new `README.md` file.
